<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Example Modbus Library: C:/modbus/library/serial.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../dir_000000.html">modbus</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_000001.html">library</a></div>
<h1>serial.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Serial API define file. 
<p>
Serial utility functions, it helps programmer easily operating serial port. It provides mostly standard functions we usually use, and <a class="el" href="../../d8/d90/serial_8c.html#a12">SerialSetMode()</a> is the private function can be use in UC box.<p>
History: Date Author Comment 08-01-2005 AceLan Kao. Create it.<p>
<dl compact><dt><b>Author:</b></dt><dd>AceLan Kao.(<a href="mailto:acelan_kao@moxa.com.tw">acelan_kao@moxa.com.tw</a>)</dd></dl>

<p>
Definition in file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
<code>#include &quot;<a class="el" href="../../d8/d10/serial_8h-source.html">serial.h</a>&quot;</code><br>

<p>
Include dependency graph for serial.c:<p><center><img src="../../d2/d85/serial_8c__incl.png" border="0" usemap="#C:/modbus/library/serial.c_map" alt=""></center>
<map name="C:/modbus/library/serial.c_map">
<area href="../../db/d11/serial_8h.html" shape="rect" coords="229,184,293,211" alt="">
</map>

<p>
<a href="../../d0/d17/serial_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a3">FindFD</a> (int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">use port number to find out the fd of the port  <a href="#a3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a7">SerialBlockRead</a> (int port, char *buf, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">block read from serial port  <a href="#a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a8">SerialClose</a> (int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">close serial port  <a href="#a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a9">SerialDataInInputQueue</a> (int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">test how much data in input queue  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a10">SerialFlowControl</a> (int port, int control)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set flow control  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a6">SerialNonBlockRead</a> (int port, char *buf, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">non-block read from serial port  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a4">SerialOpen</a> (int port, int open_flag, struct termios *tio)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">open serial port  <a href="#a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a12">SerialSetMode</a> (int port, unsigned int mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set serial port mode for RS232/RS422/RS485  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a13">SerialSetParam</a> (int port, int parity, int databits, int stopbit)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set serial port parameter  <a href="#a13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a11">SerialSetSpeed</a> (int port, unsigned int speed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set serial speed and make changes now  <a href="#a11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a5">SerialWrite</a> (int port, char *str, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">write to serial port  <a href="#a5"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a2">fd_map</a> [MAX_PORT_NUM] = { -1, -1, -1, -1, -1, -1, -1, -1}</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">-1 means SERIAL_ERROR_FD  <a href="#a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct termios&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a1">newtio</a> [MAX_PORT_NUM]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct termios&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d90/serial_8c.html#a0">oldtio</a> [MAX_PORT_NUM]</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3"></a><!-- doxytag: member="serial.c::FindFD" ref="a3" args="(int port)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FindFD           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
use port number to find out the fd of the port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>fd which is opened by using <a class="el" href="../../d8/d90/serial_8c.html#a4">SerialOpen()</a></dd></dl>

<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">30</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00021">fd_map</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00048">SERIAL_ERROR_FD</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00158">MBSerialReadASCII()</a>, <a class="el" href="../../de/d42/mbserial_8c-source.html#l00090">MBSerialReadRTU()</a>, <a class="el" href="../../d9/d7c/simple-mbgateway_8c-source.html#l00105">serial_master()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00124">SerialBlockRead()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00145">SerialClose()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00168">SerialDataInInputQueue()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00188">SerialFlowControl()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00100">SerialNonBlockRead()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00250">SerialSetMode()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00269">SerialSetParam()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00214">SerialSetSpeed()</a>, and <a class="el" href="../../d0/d17/serial_8c-source.html#l00080">SerialWrite()</a>.<div class="fragment"><pre class="fragment"><a name="l00031"></a>00031 {
<a name="l00032"></a>00032         <span class="keywordflow">if</span>( <a class="code" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[ port] == -1)
<a name="l00033"></a>00033                 <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a13">SERIAL_ERROR_FD</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="keywordflow">return</span> <a class="code" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[ port];
<a name="l00036"></a>00036 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7"></a><!-- doxytag: member="serial.c::SerialBlockRead" ref="a7" args="(int port, char *buf, int len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialBlockRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
block read from serial port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>input buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>buffer length </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return length of read str for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00124">124</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00158">MBSerialReadASCII()</a>, and <a class="el" href="../../de/d42/mbserial_8c-source.html#l00090">MBSerialReadRTU()</a>.<div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126         <span class="keywordtype">int</span> res= 0;
<a name="l00127"></a>00127         <span class="keywordtype">int</span> bytes= 0;
<a name="l00128"></a>00128         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00131"></a>00131                 <span class="keywordflow">return</span> fd;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         fcntl( fd, F_SETFL, 0);
<a name="l00134"></a>00134         res = read( fd, buf, len);
<a name="l00135"></a>00135         <span class="keywordflow">return</span> res;
<a name="l00136"></a>00136 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a7_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a7_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a7_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="178,7,244,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a8"></a><!-- doxytag: member="serial.c::SerialClose" ref="a8" args="(int port)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialClose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
close serial port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return SERIAL_OK for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00145">145</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00021">fd_map</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">oldtio</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00047">SERIAL_OK</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00297">MBSerialClose()</a>.<div class="fragment"><pre class="fragment"><a name="l00146"></a>00146 {
<a name="l00147"></a>00147         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00150"></a>00150                 <span class="keywordflow">return</span> fd;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         tcsetattr( fd, TCSANOW, &amp;(<a class="code" href="../../d8/d90/serial_8c.html#a0">oldtio</a>[ port]));
<a name="l00153"></a>00153         close( fd);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155         <a class="code" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[ port]= -1;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a12">SERIAL_OK</a>;
<a name="l00158"></a>00158 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a8_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a8_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a8_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="146,7,212,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a9"></a><!-- doxytag: member="serial.c::SerialDataInInputQueue" ref="a9" args="(int port)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialDataInInputQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
test how much data in input queue 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return number of data to be read for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00168">168</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00158">MBSerialReadASCII()</a>, <a class="el" href="../../de/d42/mbserial_8c-source.html#l00090">MBSerialReadRTU()</a>, and <a class="el" href="../../d9/d7c/simple-mbgateway_8c-source.html#l00105">serial_master()</a>.<div class="fragment"><pre class="fragment"><a name="l00169"></a>00169 {
<a name="l00170"></a>00170         <span class="keywordtype">int</span> bytes= 0;
<a name="l00171"></a>00171         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00174"></a>00174                 <span class="keywordflow">return</span> fd;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         ioctl( fd, FIONREAD, &amp;bytes);
<a name="l00177"></a>00177         <span class="keywordflow">return</span> bytes;
<a name="l00178"></a>00178 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a9_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a9_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a9_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="220,7,287,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a10"></a><!-- doxytag: member="serial.c::SerialFlowControl" ref="a10" args="(int port, int control)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialFlowControl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>control</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set flow control 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>control</em>&nbsp;</td><td>HW_FLOW_CONTROL or SW_FLOW_CONTROL </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return SERIAL_OK for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00188">188</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>, <a class="el" href="../../d8/d10/serial_8h-source.html#l00042">HW_FLOW_CONTROL</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">newtio</a>, <a class="el" href="../../d8/d10/serial_8h-source.html#l00047">SERIAL_OK</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00043">SW_FLOW_CONTROL</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00311">MBSerialFlowCtrl()</a>.<div class="fragment"><pre class="fragment"><a name="l00189"></a>00189 {
<a name="l00190"></a>00190         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00193"></a>00193                 <span class="keywordflow">return</span> fd;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="keywordflow">if</span>( control == <a class="code" href="../../db/d11/serial_8h.html#a9">HW_FLOW_CONTROL</a>)
<a name="l00196"></a>00196                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CRTSCTS;
<a name="l00197"></a>00197         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( control == <a class="code" href="../../db/d11/serial_8h.html#a10">SW_FLOW_CONTROL</a>)
<a name="l00198"></a>00198                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_iflag |= (IXON | IXOFF | IXANY);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         tcflush( fd, TCIFLUSH);
<a name="l00201"></a>00201         tcsetattr( fd, TCSANOW, &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port]);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a12">SERIAL_OK</a>;
<a name="l00204"></a>00204 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a10_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a10_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a10_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="183,7,249,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a6"></a><!-- doxytag: member="serial.c::SerialNonBlockRead" ref="a6" args="(int port, char *buf, int len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialNonBlockRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
non-block read from serial port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>input buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>buffer length </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return length of read str for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00100">100</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00265">MBSerialNonBlockRead()</a>.<div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102         <span class="keywordtype">int</span> res= 0;
<a name="l00103"></a>00103         <span class="keywordtype">int</span> bytes= 0;
<a name="l00104"></a>00104         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00107"></a>00107                 <span class="keywordflow">return</span> fd;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         fcntl( fd, F_SETFL, FNDELAY);
<a name="l00110"></a>00110         res = read( fd, buf, len);
<a name="l00111"></a>00111         <span class="keywordflow">return</span> res;
<a name="l00112"></a>00112 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a6_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a6_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a6_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="202,7,268,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a4"></a><!-- doxytag: member="serial.c::SerialOpen" ref="a4" args="(int port, int open_flag, struct termios *tio)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialOpen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>open_flag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct termios *&nbsp;</td>
          <td class="mdname" nowrap> <em>tio</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
open serial port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>open_flag</em>&nbsp;</td><td>flag used in open() function </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tio</em>&nbsp;</td><td>termios structure </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return fd for success, on error return error code</dd></dl>
&lt; port already opened<p>
&lt; save current serial port settings 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00047">47</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00021">fd_map</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">newtio</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">oldtio</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00049">SERIAL_ERROR_OPEN</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00050">MBSerialOpen()</a>.<div class="fragment"><pre class="fragment"><a name="l00048"></a>00048 {
<a name="l00049"></a>00049         <span class="keywordtype">int</span> fd;
<a name="l00050"></a>00050         <span class="keywordtype">char</span> device[ 80];
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keywordflow">if</span>( <a class="code" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[ port] != -1)                
<a name="l00053"></a>00053                 <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a14">SERIAL_ERROR_OPEN</a>;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         sprintf( device, <span class="stringliteral">"/dev/ttyM%d"</span>, port);
<a name="l00056"></a>00056         fd = open( device, open_flag);
<a name="l00057"></a>00057         <span class="keywordflow">if</span>( fd &lt;0)
<a name="l00058"></a>00058                 <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a14">SERIAL_ERROR_OPEN</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <a class="code" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[ port]= fd;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         tcgetattr( fd, &amp;(<a class="code" href="../../d8/d90/serial_8c.html#a0">oldtio</a>[ port]));       
<a name="l00063"></a>00063         <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port]= *tio;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         tcflush( fd, TCIFLUSH);
<a name="l00066"></a>00066         tcsetattr( fd, TCSANOW, &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port]);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="keywordflow">return</span> fd;
<a name="l00069"></a>00069 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12"></a><!-- doxytag: member="serial.c::SerialSetMode" ref="a12" args="(int port, unsigned int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialSetMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set serial port mode for RS232/RS422/RS485 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>serial port mode {RS232_MODE/RS485_2WIRE_MODE/RS422_MODE/RS485_4WIRE_MODE} </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return SERIAL_OK for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00250">250</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00474">MBSerialSetMode()</a>.<div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00253"></a>00253         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00254"></a>00254                 <span class="keywordflow">return</span> fd;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">return</span> ioctl( fd, MOXA_SET_OP_MODE, &amp;mode);
<a name="l00257"></a>00257 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a12_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a12_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a12_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="167,7,233,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a13"></a><!-- doxytag: member="serial.c::SerialSetParam" ref="a13" args="(int port, int parity, int databits, int stopbit)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialSetParam           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>parity</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>databits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>stopbit</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set serial port parameter 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>parity</em>&nbsp;</td><td>parity check, 0: none, 1: odd, 2: even, 3: space </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>databits</em>&nbsp;</td><td>data bits </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stopbit</em>&nbsp;</td><td>stop bit </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return fd for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00269">269</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">newtio</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00047">SERIAL_OK</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00326">MBSerialSetParam()</a>.<div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00272"></a>00272         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00273"></a>00273                 <span class="keywordflow">return</span> fd;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordflow">if</span>( parity == 0)
<a name="l00276"></a>00276                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag &amp;= ~PARENB;
<a name="l00277"></a>00277         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( parity == 1)
<a name="l00278"></a>00278         {
<a name="l00279"></a>00279                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= PARENB;
<a name="l00280"></a>00280                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= PARODD;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( parity == 2)
<a name="l00283"></a>00283         {
<a name="l00284"></a>00284                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= PARENB;
<a name="l00285"></a>00285                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag &amp;= ~PARODD;
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( parity == 3)
<a name="l00288"></a>00288         {
<a name="l00289"></a>00289                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag &amp;= ~PARENB;
<a name="l00290"></a>00290                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag &amp;= ~CSTOPB;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         <span class="keywordflow">if</span>( databits == 5)
<a name="l00294"></a>00294                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CS5;
<a name="l00295"></a>00295         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( databits == 6)
<a name="l00296"></a>00296                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CS6;
<a name="l00297"></a>00297         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( databits == 7)
<a name="l00298"></a>00298                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CS7;
<a name="l00299"></a>00299         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( databits == 8)
<a name="l00300"></a>00300                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CS8;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keywordflow">if</span>( stopbit == 1)
<a name="l00303"></a>00303                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag &amp;= ~CSTOPB;
<a name="l00304"></a>00304         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stopbit == 2)
<a name="l00305"></a>00305                 <a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port].c_cflag |= CSTOPB;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         tcflush( fd, TCIFLUSH);
<a name="l00308"></a>00308         tcsetattr( fd, TCSANOW, &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port]);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a12">SERIAL_OK</a>;
<a name="l00311"></a>00311 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a13_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a13_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a13_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="172,7,239,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a11"></a><!-- doxytag: member="serial.c::SerialSetSpeed" ref="a11" args="(int port, unsigned int speed)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialSetSpeed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>speed</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set serial speed and make changes now 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>speed</em>&nbsp;</td><td>unsigned integer for new speed </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return SERIAL_OK for success, on error return error code</dd></dl>
&lt; error<p>
&lt; i start from 1, bellow 50 will be set to B0 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00214">214</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">newtio</a>, and <a class="el" href="../../d8/d10/serial_8h-source.html#l00047">SERIAL_OK</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00492">MBSerialSetSpeed()</a>, <a class="el" href="../../d9/d7c/simple-mbgateway_8c-source.html#l00105">serial_master()</a>, and <a class="el" href="../../d9/d7c/simple-mbgateway_8c-source.html#l00211">serial_slave()</a>.<div class="fragment"><pre class="fragment"><a name="l00215"></a>00215 {
<a name="l00216"></a>00216         <span class="keywordtype">int</span> i, table_size= 23;
<a name="l00217"></a>00217         <span class="keywordtype">int</span> speed_table1[]={ 0, 50, 75, 110, 134, 150, 200, 300,
<a name="l00218"></a>00218                              600, 1200, 1800, 2400, 4800, 9600,
<a name="l00219"></a>00219                              19200, 38400, 57600, 115200, 230400,
<a name="l00220"></a>00220                              460800, 500000, 576000, 921600};
<a name="l00221"></a>00221         <span class="keywordtype">int</span> speed_table2[]={ B0, B50, B75, B110, B134, B150, B200, B300,
<a name="l00222"></a>00222                              B600, B1200, B1800, B2400, B4800, B9600,
<a name="l00223"></a>00223                              B19200, B38400, B57600, B115200, B230400,
<a name="l00224"></a>00224                              B460800, B500000, B576000, B921600};
<a name="l00225"></a>00225         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00228"></a>00228                 <span class="keywordflow">return</span> fd;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="keywordflow">for</span>( i= 1; i&lt; table_size; i++)  
<a name="l00231"></a>00231                 <span class="keywordflow">if</span>( speed_table1[ i] &gt;= speed)
<a name="l00232"></a>00232                         <span class="keywordflow">break</span>;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         cfsetispeed( &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port], speed_table2[ i]);
<a name="l00235"></a>00235         cfsetospeed( &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port], speed_table2[ i]);
<a name="l00236"></a>00236         tcsetattr( fd, TCSANOW, &amp;<a class="code" href="../../d8/d90/serial_8c.html#a1">newtio</a>[ port]);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="keywordflow">return</span> <a class="code" href="../../db/d11/serial_8h.html#a12">SERIAL_OK</a>;
<a name="l00239"></a>00239 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a11_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a11_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a11_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="170,7,236,33" alt="">
</map>
    </td>
  </tr>
</table>
<a class="anchor" name="a5"></a><!-- doxytag: member="serial.c::SerialWrite" ref="a5" args="(int port, char *str, int len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SerialWrite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
write to serial port 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>string to write </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>length of str </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>return length of str for success, on error return error code</dd></dl>
&lt; error 
<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00080">80</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
References <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>.
<p>
Referenced by <a class="el" href="../../de/d42/mbserial_8c-source.html#l00280">MBSerialWrite()</a>.<div class="fragment"><pre class="fragment"><a name="l00081"></a>00081 {
<a name="l00082"></a>00082         <span class="keywordtype">int</span> fd= <a class="code" href="../../d8/d90/serial_8c.html#a3">FindFD</a>( port);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084         <span class="keywordflow">if</span>( fd &lt; 0)                     
<a name="l00085"></a>00085                 <span class="keywordflow">return</span> fd;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         <span class="keywordflow">return</span> write( fd, str, len);
<a name="l00088"></a>00088 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="../../d8/d90/serial_8c_a5_cgraph.png" border="0" usemap="#d8/d90/serial_8c_a5_cgraph_map" alt=""></center>
<map name="d8/d90/serial_8c_a5_cgraph_map">
<area href="../../d8/d90/serial_8c.html#a3" shape="rect" coords="146,7,212,33" alt="">
</map>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a2"></a><!-- doxytag: member="serial.c::fd_map" ref="a2" args="[MAX_PORT_NUM]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d8/d90/serial_8c.html#a2">fd_map</a>[MAX_PORT_NUM] = { -1, -1, -1, -1, -1, -1, -1, -1}<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
-1 means SERIAL_ERROR_FD 
<p>

<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00021">21</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d17/serial_8c-source.html#l00030">FindFD()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00145">SerialClose()</a>, and <a class="el" href="../../d0/d17/serial_8c-source.html#l00047">SerialOpen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1"></a><!-- doxytag: member="serial.c::newtio" ref="a1" args="[MAX_PORT_NUM]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct termios <a class="el" href="../../d8/d90/serial_8c.html#a1">newtio</a>[MAX_PORT_NUM]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">20</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d17/serial_8c-source.html#l00188">SerialFlowControl()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00047">SerialOpen()</a>, <a class="el" href="../../d0/d17/serial_8c-source.html#l00269">SerialSetParam()</a>, and <a class="el" href="../../d0/d17/serial_8c-source.html#l00214">SerialSetSpeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0"></a><!-- doxytag: member="serial.c::oldtio" ref="a0" args="[MAX_PORT_NUM]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct termios <a class="el" href="../../d8/d90/serial_8c.html#a0">oldtio</a>[MAX_PORT_NUM]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d17/serial_8c-source.html#l00020">20</a> of file <a class="el" href="../../d0/d17/serial_8c-source.html">serial.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d17/serial_8c-source.html#l00145">SerialClose()</a>, and <a class="el" href="../../d0/d17/serial_8c-source.html#l00047">SerialOpen()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Fri Sep 9 20:27:54 2005 for Example Modbus Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
